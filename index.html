<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TicketTrack Pilates</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#334155', // slate-700
              'primary-dark': '#1e293b', // slate-800
              secondary: '#f1f5f9', // slate-100
              accent: '#6366f1', // indigo-500
              'accent-dark': '#4f46e5', // indigo-600
            },
          },
        },
      }
    </script>
    <!-- Add Babel Standalone for in-browser JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-secondary">
    <div id="root"></div>
    <!-- 
      All application code is now consolidated into this single script block.
      This is a robust, self-contained approach that eliminates all module
      loading errors and race conditions.
    -->
    <script type="text/babel" data-type="module">
      import React, { useState, useMemo, useEffect, useCallback } from 'https://esm.sh/react@^19.1.1';
      import { createRoot } from 'https://esm.sh/react-dom@^19.1.1/client';
      import { 
        Calendar, Users, ClipboardList, LayoutDashboard, 
        DollarSign, Ticket, Clock, AlertTriangle,
        PlusCircle, Edit, History,
        Trash2, X
      } from 'https://esm.sh/lucide-react@^0.539.0';

      // --- From types.js ---
      const ClientStatus = Object.freeze({
        ACTIVE: 'active',
        INACTIVE: 'inactive',
      });

      const TicketType = Object.freeze({
        PRIVATE: 'private',
        GROUP: 'group',
      });

      const PackTemplateStatus = Object.freeze({
        ACTIVE: 'active',
        INACTIVE: 'inactive',
      });

      const PackHistoryType = Object.freeze({
        PURCHASE: 'purchase',
        ATTENDANCE: 'attendance',
        EXPIRY_CHANGE: 'expiry_change',
      });

      const Page = Object.freeze({
          DASHBOARD: 'dashboard',
          CLIENTS: 'clients',
          TEMPLATES: 'templates',
          ATTENDANCE: 'attendance',
      });

      // --- From hooks/useAppData.js ---
      const APP_DATA_KEY = 'ticketTrackPilatesData';

      const getInitialData = () => {
          try {
              const storedData = localStorage.getItem(APP_DATA_KEY);
              if (storedData) {
                  return JSON.parse(storedData);
              }
          } catch (error) {
              console.error("Failed to parse data from localStorage", error);
          }
          
          const client1Id = crypto.randomUUID();
          const client2Id = crypto.randomUUID();
          const template1Id = crypto.randomUUID();
          const template2Id = crypto.randomUUID();

          const today = new Date();
          const purchaseDate1 = new Date(today);
          purchaseDate1.setDate(today.getDate() - 40);

          const purchaseDate2 = new Date(today);
          purchaseDate2.setDate(today.getDate() - 15);

          const attendanceDate1 = new Date(today);
          attendanceDate1.setDate(today.getDate() - 20);

          const attendanceDate2 = new Date(today);
          attendanceDate2.setDate(today.getDate() - 10);

          const expiryDate1 = new Date(purchaseDate1);
          expiryDate1.setMonth(expiryDate1.getMonth() + 6);
          
          const expiryDate2 = new Date(purchaseDate2);
          expiryDate2.setMonth(expiryDate2.getMonth() + 3);

          const purchasedPack1Id = crypto.randomUUID();

          return {
              clients: [
                  { id: client1Id, firstName: 'Jane', lastName: 'Doe', email: 'jane.doe@example.com', phone: '123-456-7890', status: ClientStatus.ACTIVE },
                  { id: client2Id, firstName: 'John', lastName: 'Smith', email: 'john.smith@example.com', phone: '098-765-4321', status: ClientStatus.ACTIVE },
                  { id: crypto.randomUUID(), firstName: 'Emily', lastName: 'Jones', email: 'emily.jones@example.com', phone: '555-555-5555', status: ClientStatus.INACTIVE },
              ],
              packTemplates: [
                  { id: template1Id, name: '10 Group Classes', ticketCount: 10, ticketType: TicketType.GROUP, price: 200, expiryMonths: 6, status: PackTemplateStatus.ACTIVE },
                  { id: template2Id, name: '5 Private Sessions', ticketCount: 5, ticketType: TicketType.PRIVATE, price: 450, expiryMonths: 3, status: PackTemplateStatus.ACTIVE },
                  { id: crypto.randomUUID(), name: '20 Group Classes (Old)', ticketCount: 20, ticketType: TicketType.GROUP, price: 350, expiryMonths: 12, status: PackTemplateStatus.INACTIVE },
              ],
              purchasedPacks: [
                  {
                      id: purchasedPack1Id,
                      clientId: client1Id,
                      templateId: template1Id,
                      purchaseDate: purchaseDate1.toISOString(),
                      expiryDate: expiryDate1.toISOString(),
                      initialTickets: 10,
                      ticketsRemaining: 8,
                      purchasePrice: 200,
                      history: [
                          { id: crypto.randomUUID(), date: purchaseDate1.toISOString(), type: PackHistoryType.PURCHASE, details: 'Purchased pack for $200.00' },
                          { id: crypto.randomUUID(), date: attendanceDate1.toISOString(), type: PackHistoryType.ATTENDANCE, details: 'Attended group class' },
                          { id: crypto.randomUUID(), date: attendanceDate2.toISOString(), type: PackHistoryType.ATTENDANCE, details: 'Attended group class' },
                      ]
                  },
                  {
                      id: crypto.randomUUID(),
                      clientId: client2Id,
                      templateId: template2Id,
                      purchaseDate: purchaseDate2.toISOString(),
                      expiryDate: expiryDate2.toISOString(),
                      initialTickets: 5,
                      ticketsRemaining: 5,
                      purchasePrice: 450,
                      history: [
                          { id: crypto.randomUUID(), date: purchaseDate2.toISOString(), type: PackHistoryType.PURCHASE, details: 'Purchased pack for $450.00' },
                      ]
                  }
              ],
              attendanceRecords: [
                  { id: crypto.randomUUID(), classDate: attendanceDate1.toISOString(), classType: TicketType.GROUP, clientId: client1Id, purchasedPackId: purchasedPack1Id },
                  { id: crypto.randomUUID(), classDate: attendanceDate2.toISOString(), classType: TicketType.GROUP, clientId: client1Id, purchasedPackId: purchasedPack1Id },
              ],
          };
      };

      const useAppData = () => {
          const [clients, setClients] = useState([]);
          const [packTemplates, setPackTemplates] = useState([]);
          const [purchasedPacks, setPurchasedPacks] = useState([]);
          const [attendanceRecords, setAttendanceRecords] = useState([]);
          
          useEffect(() => {
              const data = getInitialData();
              setClients(data.clients);
              setPackTemplates(data.packTemplates);
              setPurchasedPacks(data.purchasedPacks);
              setAttendanceRecords(data.attendanceRecords);
          }, []);

          useEffect(() => {
              try {
                  const appData = JSON.stringify({ clients, packTemplates, purchasedPacks, attendanceRecords });
                  localStorage.setItem(APP_DATA_KEY, appData);
              } catch (error) {
                  console.error("Failed to save data to localStorage", error);
              }
          }, [clients, packTemplates, purchasedPacks, attendanceRecords]);
          
          const addClient = (client) => setClients(prev => [...prev, { ...client, id: crypto.randomUUID() }]);
          const updateClient = (updatedClient) => setClients(prev => prev.map(c => c.id === updatedClient.id ? updatedClient : c));

          const addPackTemplate = (template) => setPackTemplates(prev => [...prev, { ...template, id: crypto.randomUUID() }]);
          const updatePackTemplate = (updatedTemplate) => {
              if (updatedTemplate.status === PackTemplateStatus.INACTIVE) {
                  const hasActivePacks = purchasedPacks.some(p => 
                      p.templateId === updatedTemplate.id &&
                      p.ticketsRemaining > 0 &&
                      new Date(p.expiryDate) > new Date()
                  );
                  if (hasActivePacks) {
                      alert('Cannot make template inactive as there are active client packs using it.');
                      return;
                  }
              }
              setPackTemplates(prev => prev.map(t => t.id === updatedTemplate.id ? updatedTemplate : t));
          };
          
          const recordPurchase = (clientId, templateId, purchaseDate) => {
              const template = packTemplates.find(t => t.id === templateId);
              if (!template) return;

              const expiryDate = new Date(purchaseDate);
              expiryDate.setMonth(expiryDate.getMonth() + template.expiryMonths);

              const newPack = {
                  id: crypto.randomUUID(),
                  clientId,
                  templateId,
                  purchaseDate: purchaseDate.toISOString(),
                  expiryDate: expiryDate.toISOString(),
                  initialTickets: template.ticketCount,
                  ticketsRemaining: template.ticketCount,
                  purchasePrice: template.price,
                  history: [
                      { id: crypto.randomUUID(), date: purchaseDate.toISOString(), type: PackHistoryType.PURCHASE, details: `Purchased pack for $${template.price.toFixed(2)}` }
                  ]
              };
              setPurchasedPacks(prev => [...prev, newPack]);
          };

          const updatePurchasedPackExpiry = (packId, newExpiryDate) => {
              setPurchasedPacks(prev => prev.map(pack => {
                  if (pack.id === packId) {
                      const oldExpiryDate = new Date(pack.expiryDate).toLocaleDateString();
                      const updatedHistory = {
                          id: crypto.randomUUID(),
                          date: new Date().toISOString(),
                          type: PackHistoryType.EXPIRY_CHANGE,
                          details: `Expiry date changed from ${oldExpiryDate} to ${newExpiryDate.toLocaleDateString()}`
                      };
                      return {
                          ...pack,
                          expiryDate: newExpiryDate.toISOString(),
                          history: [...pack.history, updatedHistory]
                      };
                  }
                  return pack;
              }));
          };

          const recordAttendance = useCallback((classDate, classType, clientIds) => {
              const updatedPacks = [...purchasedPacks];
              const newAttendanceRecords = [];

              clientIds.forEach(clientId => {
                  const clientPacks = updatedPacks
                      .filter(p => {
                          const template = packTemplates.find(t => t.id === p.templateId);
                          return p.clientId === clientId &&
                                template?.ticketType === classType &&
                                p.ticketsRemaining > 0 &&
                                new Date(p.expiryDate) >= classDate;
                      })
                      .sort((a, b) => {
                          const expiryA = new Date(a.expiryDate).getTime();
                          const expiryB = new Date(b.expiryDate).getTime();
                          if (expiryA !== expiryB) return expiryA - expiryB;
                          return new Date(a.purchaseDate).getTime() - new Date(b.purchaseDate).getTime();
                      });

                  if (clientPacks.length > 0) {
                      const packToDeduct = clientPacks[0];
                      packToDeduct.ticketsRemaining -= 1;
                      packToDeduct.history.push({
                          id: crypto.randomUUID(),
                          date: classDate.toISOString(),
                          type: PackHistoryType.ATTENDANCE,
                          details: `Attended ${classType} class`
                      });
                      
                      newAttendanceRecords.push({
                          id: crypto.randomUUID(),
                          classDate: classDate.toISOString(),
                          classType,
                          clientId,
                          purchasedPackId: packToDeduct.id
                      });
                  }
              });

              setPurchasedPacks(updatedPacks);
              setAttendanceRecords(prev => [...prev, ...newAttendanceRecords]);
          }, [purchasedPacks, packTemplates]);

          const deleteAttendance = useCallback((recordId) => {
              const recordToDelete = attendanceRecords.find(r => r.id === recordId);
              if (!recordToDelete) return;

              setPurchasedPacks(prev => prev.map(pack => {
                  if (pack.id === recordToDelete.purchasedPackId) {
                      return {
                          ...pack,
                          ticketsRemaining: pack.ticketsRemaining + 1,
                          history: pack.history.filter(h => h.type !== PackHistoryType.ATTENDANCE || new Date(h.date).getTime() !== new Date(recordToDelete.classDate).getTime())
                      };
                  }
                  return pack;
              }));

              setAttendanceRecords(prev => prev.filter(r => r.id !== recordId));
          }, [attendanceRecords]);
          
          return {
              clients,
              addClient,
              updateClient,
              packTemplates,
              addPackTemplate,
              updatePackTemplate,
              purchasedPacks,
              recordPurchase,
              updatePurchasedPackExpiry,
              attendanceRecords,
              recordAttendance,
              deleteAttendance
          };
      };

      // --- From screens/DashboardScreen.js ---
      const StatCard = ({ icon, title, value, iconBg, iconColor }) => (
          <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200/80 flex items-center">
              <div className={`rounded-full p-3 mr-4 ${iconBg} ${iconColor}`}>
                  {icon}
              </div>
              <div>
                  <p className="text-sm text-slate-500 font-medium">{title}</p>
                  <p className="text-2xl font-bold text-primary-dark">{value}</p>
              </div>
          </div>
      );

      const DashboardScreen = ({ data }) => {
          const { clients, purchasedPacks, attendanceRecords, packTemplates } = data;

          const stats = useMemo(() => {
              const thirtyDaysAgo = new Date();
              thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);

              const totalSales = purchasedPacks
                  .filter(p => new Date(p.purchaseDate) >= thirtyDaysAgo)
                  .reduce((sum, p) => sum + p.purchasePrice, 0);

              const totalTicketsUsed = attendanceRecords
                  .filter(a => new Date(a.classDate) >= thirtyDaysAgo)
                  .length;

              return { totalSales, totalTicketsUsed };
          }, [purchasedPacks, attendanceRecords]);

          const expiringPacks = useMemo(() => {
              const thirtyDaysFromNow = new Date();
              thirtyDaysFromNow.setDate(thirtyDaysFromNow.getDate() + 30);
              const today = new Date();

              return purchasedPacks
                  .filter(p => {
                      const expiryDate = new Date(p.expiryDate);
                      return expiryDate >= today && expiryDate <= thirtyDaysFromNow && p.ticketsRemaining > 0;
                  })
                  .sort((a, b) => new Date(a.expiryDate).getTime() - new Date(b.expiryDate).getTime())
                  .map(p => {
                      const client = clients.find(c => c.id === p.clientId);
                      const template = packTemplates.find(t => t.id === p.templateId);
                      return { ...p, client, template };
                  });
          }, [purchasedPacks, clients, packTemplates]);
          
          const lowBalanceClients = useMemo(() => {
              const today = new Date();
              return purchasedPacks
                  .filter(p => p.ticketsRemaining === 1 && new Date(p.expiryDate) >= today)
                  .map(p => {
                      const client = clients.find(c => c.id === p.clientId);
                      const template = packTemplates.find(t => t.id === p.templateId);
                      return { ...p, client, template };
                  });
          }, [purchasedPacks, clients, packTemplates]);

          return (
              <div className="space-y-8">
                  <h2 className="text-3xl font-bold text-primary-dark">Dashboard</h2>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <StatCard 
                          icon={<DollarSign className="h-6 w-6"/>} 
                          title="Total Sales (Last 30 Days)" 
                          value={`$${stats.totalSales.toFixed(2)}`}
                          iconBg="bg-emerald-100"
                          iconColor="text-emerald-600"
                      />
                      <StatCard 
                          icon={<Ticket className="h-6 w-6"/>} 
                          title="Tickets Used (Last 30 Days)" 
                          value={stats.totalTicketsUsed}
                          iconBg="bg-sky-100"
                          iconColor="text-sky-600"
                      />
                  </div>

                  <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                      <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200/80">
                          <h3 className="text-xl font-semibold text-primary-dark mb-4 flex items-center">
                              <Clock className="h-6 w-6 mr-3 text-accent" />
                              Packs Expiring in Next 30 Days
                          </h3>
                          <div className="space-y-0 max-h-96 overflow-y-auto">
                              {expiringPacks.length > 0 ? expiringPacks.map((p, index) => (
                                  <div key={p.id} className={`p-4 border-b border-slate-200 ${index === expiringPacks.length - 1 ? 'border-b-0' : ''}`}>
                                      <p className="font-semibold text-primary-dark">{p.client?.firstName} {p.client?.lastName}</p>
                                      <p className="text-sm text-slate-500">{p.template?.name}</p>
                                      <div className="flex justify-between items-baseline text-sm mt-1">
                                          <span className="font-medium text-slate-600">Tickets: {p.ticketsRemaining}</span>
                                          <span className="font-semibold text-amber-700">Expires: {new Date(p.expiryDate).toLocaleDateString()}</span>
                                      </div>
                                  </div>
                              )) : <p className="text-slate-500 p-4">No packs expiring soon.</p>}
                          </div>
                      </div>

                      <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200/80">
                          <h3 className="text-xl font-semibold text-primary-dark mb-4 flex items-center">
                              <AlertTriangle className="h-6 w-6 mr-3 text-yellow-500" />
                              Critical Low Balance (1 Ticket Left)
                          </h3>
                          <div className="space-y-0 max-h-96 overflow-y-auto">
                              {lowBalanceClients.length > 0 ? lowBalanceClients.map((p, index) => (
                                  <div key={p.id} className={`p-4 border-b border-slate-200 ${index === lowBalanceClients.length - 1 ? 'border-b-0' : ''}`}>
                                      <p className="font-semibold text-primary-dark">{p.client?.firstName} {p.client?.lastName}</p>
                                      <p className="text-sm text-slate-500">{p.template?.name}</p>
                                  </div>
                              )) : <p className="text-slate-500 p-4">No clients with a critically low balance.</p>}
                          </div>
                      </div>
                  </div>
              </div>
          );
      };

      // --- From screens/ClientsScreen.js ---
      const ClientFormModal = ({ client, onSave, onClose, onToggleStatus }) => {
          const [formData, setFormData] = useState({
              firstName: client?.firstName || '',
              lastName: client?.lastName || '',
              email: client?.email || '',
              phone: client?.phone || '',
          });

          const handleChange = (e) => {
              const { name, value } = e.target;
              setFormData(prev => ({ ...prev, [name]: value }));
          };

          const handleSubmit = (e) => {
              e.preventDefault();
              onSave({ ...formData, id: client?.id || '', status: client?.status || ClientStatus.ACTIVE });
          };
          
          return (
              <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-xl shadow-xl p-8 w-full max-w-md">
                      <h2 className="text-2xl font-bold mb-6 text-primary-dark">{client ? 'Edit Client' : 'Add New Client'}</h2>
                      <form onSubmit={handleSubmit} className="space-y-4">
                          <div>
                              <label htmlFor="firstName" className="block text-sm font-medium text-slate-700">First Name</label>
                              <input type="text" name="firstName" value={formData.firstName} onChange={handleChange} required className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-accent focus:border-accent"/>
                          </div>
                          <div>
                              <label htmlFor="lastName" className="block text-sm font-medium text-slate-700">Last Name</label>
                              <input type="text" name="lastName" value={formData.lastName} onChange={handleChange} required className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-accent focus:border-accent"/>
                          </div>
                          <div>
                              <label htmlFor="email" className="block text-sm font-medium text-slate-700">Email</label>
                              <input type="email" name="email" value={formData.email} onChange={handleChange} required className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-accent focus:border-accent"/>
                          </div>
                          <div>
                              <label htmlFor="phone" className="block text-sm font-medium text-slate-700">Phone</label>
                              <input type="tel" name="phone" value={formData.phone} onChange={handleChange} className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-accent focus:border-accent"/>
                          </div>
                          <div className="flex justify-between items-center pt-6">
                              <div>
                                  {client && (
                                      <button 
                                          type="button" 
                                          onClick={() => {
                                              onToggleStatus(client);
                                              onClose();
                                          }}
                                          className={`px-4 py-2 text-sm font-medium rounded-md transition-colors ${
                                              client.status === ClientStatus.ACTIVE
                                                  ? 'bg-rose-100 text-rose-800 hover:bg-rose-200'
                                                  : 'bg-emerald-100 text-emerald-800 hover:bg-emerald-200'
                                          }`}
                                      >
                                          {client.status === ClientStatus.ACTIVE ? 'Set to Inactive' : 'Set to Active'}
                                      </button>
                                  )}
                              </div>
                              <div className="flex justify-end space-x-4">
                                  <button type="button" onClick={onClose} className="px-4 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300 font-semibold">Cancel</button>
                                  <button type="submit" className="px-4 py-2 bg-primary-dark text-white rounded-md hover:bg-primary font-semibold">Save Client</button>
                              </div>
                          </div>
                      </form>
                  </div>
              </div>
          );
      };

      const PurchaseFormModal = ({ client, templates, onSave, onClose }) => {
          const [templateId, setTemplateId] = useState('');
          const [purchaseDate, setPurchaseDate] = useState(new Date().toISOString().split('T')[0]);

          const handleSubmit = (e) => {
              e.preventDefault();
              if (!templateId) {
                  alert('Please select a pack template.');
                  return;
              }
              onSave(client.id, templateId, new Date(purchaseDate));
          };

          return (
              <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-xl shadow-xl p-8 w-full max-w-md">
                      <h2 className="text-2xl font-bold mb-6 text-primary-dark">Record Purchase for {client.firstName}</h2>
                      <form onSubmit={handleSubmit} className="space-y-4">
                          <div>
                              <label htmlFor="templateId" className="block text-sm font-medium text-slate-700">Ticket Pack</label>
                              <select name="templateId" value={templateId} onChange={e => setTemplateId(e.target.value)} required className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-accent focus:border-accent">
                                  <option value="">Select a pack</option>
                                  {templates.filter(t => t.status === 'active').map(t => (
                                      <option key={t.id} value={t.id}>{t.name} - ${t.price}</option>
                                  ))}
                              </select>
                          </div>
                          <div>
                              <label htmlFor="purchaseDate" className="block text-sm font-medium text-slate-700">Purchase Date</label>
                              <input type="date" name="purchaseDate" value={purchaseDate} onChange={e => setPurchaseDate(e.target.value)} required className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-accent focus:border-accent"/>
                          </div>
                          <div className="flex justify-end space-x-4 pt-6">
                              <button type="button" onClick={onClose} className="px-4 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300 font-semibold">Cancel</button>
                              <button type="submit" className="px-4 py-2 bg-accent text-white rounded-md hover:bg-accent-dark font-semibold">Record Purchase</button>
                          </div>
                      </form>
                  </div>
              </div>
          );
      };

      const ClientDetailView = ({ client, packs, templates, onBack, onRecordPurchase, onUpdateExpiry }) => {
          const [purchasing, setPurchasing] = useState(false);
          const [editingExpiryPackId, setEditingExpiryPackId] = useState(null);
          const [newExpiryDate, setNewExpiryDate] = useState('');

          const handleEditExpiry = (pack) => {
              setEditingExpiryPackId(pack.id);
              setNewExpiryDate(new Date(pack.expiryDate).toISOString().split('T')[0]);
          };
          
          const handleSaveExpiry = () => {
              if (editingExpiryPackId && newExpiryDate) {
                  onUpdateExpiry(editingExpiryPackId, new Date(newExpiryDate));
                  setEditingExpiryPackId(null);
              }
          };

          return (
              <div className="bg-white p-6 sm:p-8 rounded-xl shadow-sm border border-slate-200/80">
                  <button onClick={onBack} className="mb-6 text-accent hover:underline font-semibold">← Back to Client List</button>
                  <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center">
                      <div className="mb-4 sm:mb-0">
                          <h2 className="text-3xl font-bold text-primary-dark">{client.firstName} {client.lastName}</h2>
                          <p className="text-slate-500">{client.email} | {client.phone}</p>
                      </div>
                      <button onClick={() => setPurchasing(true)} className="flex items-center px-4 py-2 bg-accent text-white rounded-md hover:bg-accent-dark font-semibold">
                          <PlusCircle className="h-5 w-5 mr-2" />
                          Record Purchase
                      </button>
                  </div>
                  <div className="mt-8">
                      <h3 className="text-xl font-semibold text-primary-dark mb-4">Purchased Packs</h3>
                      <div className="space-y-4">
                          {packs.length > 0 ? packs.map(pack => {
                              const getPackStatus = (p) => {
                                  const today = new Date();
                                  today.setHours(0, 0, 0, 0);
                                  if (new Date(p.expiryDate) < today) {
                                      return { text: 'Expired', color: 'bg-slate-200 text-slate-800' };
                                  }
                                  if (p.ticketsRemaining <= 0) {
                                      return { text: 'Used', color: 'bg-amber-100 text-amber-800' };
                                  }
                                  return { text: 'Active', color: 'bg-emerald-100 text-emerald-800' };
                              };
                              const status = getPackStatus(pack);

                              return (
                                  <div key={pack.id} className="bg-slate-50 p-5 rounded-xl border border-slate-200">
                                      <div className="flex justify-between items-start">
                                          <div>
                                              <p className="font-bold text-lg text-primary-dark">{pack.template?.name}</p>
                                              <p className="text-sm text-slate-500 capitalize">{pack.template?.ticketType} Tickets</p>
                                          </div>
                                          <span className={`px-2 py-1 text-xs font-semibold rounded-full ${status.color}`}>
                                              {status.text}
                                          </span>
                                      </div>

                                      <div className="mt-4 grid grid-cols-2 sm:grid-cols-3 gap-4 text-sm">
                                          <div>
                                              <p className="text-slate-500">Purchased</p>
                                              <p className="font-semibold text-primary-dark">{new Date(pack.purchaseDate).toLocaleDateString()}</p>
                                          </div>
                                          <div>
                                              <p className="text-slate-500">Expires</p>
                                              <p className="font-semibold text-primary-dark">{new Date(pack.expiryDate).toLocaleDateString()}</p>
                                          </div>
                                          <div className="col-span-2 sm:col-span-1">
                                              <div className="flex justify-between items-baseline">
                                                  <span className="text-slate-500">Tickets Remaining</span>
                                                  <span className="font-semibold text-primary-dark text-lg">{pack.ticketsRemaining} / {pack.initialTickets}</span>
                                              </div>
                                              <div className="w-full bg-slate-200 rounded-full h-2.5 mt-1">
                                                  <div
                                                      className="bg-accent h-2.5 rounded-full transition-all duration-500"
                                                      style={{ width: `${pack.initialTickets > 0 ? (pack.ticketsRemaining / pack.initialTickets) * 100 : 0}%` }}
                                                  ></div>
                                              </div>
                                          </div>
                                      </div>

                                      <div className="mt-4 pt-4 border-t border-slate-200">
                                          <div className="flex justify-between items-center">
                                              <details>
                                                  <summary className="cursor-pointer text-accent font-medium flex items-center text-sm">
                                                      <History className="h-4 w-4 mr-2"/>
                                                      View History
                                                  </summary>
                                                  <ul className="mt-2 space-y-1 text-sm text-slate-600 pl-6 list-disc">
                                                      {pack.history.sort((a,b) => new Date(b.date).getTime() - new Date(a.date).getTime()).map(log => (
                                                          <li key={log.id}>
                                                              <strong>{new Date(log.date).toLocaleDateString()}:</strong> {log.details}
                                                          </li>
                                                      ))}
                                                  </ul>
                                              </details>
                                              
                                              <div>
                                                  {editingExpiryPackId === pack.id ? (
                                                      <div className="flex justify-end items-center space-x-2">
                                                          <input type="date" value={newExpiryDate} onChange={e => setNewExpiryDate(e.target.value)} className="border-slate-300 rounded-md shadow-sm text-sm p-1" />
                                                          <button onClick={handleSaveExpiry} className="px-3 py-1 bg-primary-dark text-white text-xs rounded-md font-semibold">Save</button>
                                                          <button onClick={() => setEditingExpiryPackId(null)} className="px-3 py-1 bg-slate-200 text-xs rounded-md font-semibold">Cancel</button>
                                                      </div>
                                                  ) : (
                                                      <button onClick={() => handleEditExpiry(pack)} className="flex items-center text-sm text-accent hover:underline font-semibold">
                                                          <Edit className="h-4 w-4 mr-1"/> Pause/Edit Expiry
                                                      </button>
                                                  )}
                                              </div>
                                          </div>
                                      </div>
                                  </div>
                              );
                          }) : <p className="text-slate-500">No packs purchased yet.</p>}
                      </div>
                  </div>
                  {purchasing && <PurchaseFormModal client={client} templates={templates} onClose={() => setPurchasing(false)} onSave={(...args) => { onRecordPurchase(...args); setPurchasing(false); }} />}
              </div>
          );
      }

      const ClientsScreen = ({ data }) => {
          const { clients, updateClient, addClient, purchasedPacks, packTemplates, recordPurchase, updatePurchasedPackExpiry } = data;
          const [isModalOpen, setIsModalOpen] = useState(false);
          const [editingClient, setEditingClient] = useState(null);
          const [selectedClient, setSelectedClient] = useState(null);

          const handleSaveClient = (clientData) => {
              if (editingClient) {
                  updateClient(clientData);
              } else {
                  addClient(clientData);
              }
              setIsModalOpen(false);
              setEditingClient(null);
          };
          
          const handleToggleStatus = (client) => {
              const newStatus = client.status === ClientStatus.ACTIVE ? ClientStatus.INACTIVE : ClientStatus.ACTIVE;
              updateClient({ ...client, status: newStatus });
          };

          if (selectedClient) {
              const clientPacks = purchasedPacks
                  .filter(p => p.clientId === selectedClient.id)
                  .map(p => ({ ...p, template: packTemplates.find(t => t.id === p.templateId) }))
                  .sort((a,b) => new Date(b.purchaseDate).getTime() - new Date(a.purchaseDate).getTime());
              
              return <ClientDetailView 
                  client={selectedClient} 
                  packs={clientPacks}
                  templates={packTemplates}
                  onBack={() => setSelectedClient(null)}
                  onRecordPurchase={recordPurchase}
                  onUpdateExpiry={updatePurchasedPackExpiry}
              />;
          }

          return (
              <div className="space-y-6">
                  <div className="flex justify-between items-center">
                      <h2 className="text-3xl font-bold text-primary-dark">Clients</h2>
                      <button onClick={() => { setEditingClient(null); setIsModalOpen(true); }} className="flex items-center px-4 py-2 bg-primary-dark text-white rounded-md shadow-sm hover:bg-primary font-semibold">
                          <PlusCircle className="h-5 w-5 mr-2" />
                          Add Client
                      </button>
                  </div>

                  <div className="bg-white rounded-xl shadow-sm overflow-hidden border border-slate-200/80">
                      <ul className="divide-y divide-slate-200">
                          {clients.sort((a,b) => a.lastName.localeCompare(b.lastName)).map(client => {
                              const today = new Date();
                              today.setHours(0, 0, 0, 0);

                              const activePacks = purchasedPacks.filter(p => 
                                  p.clientId === client.id &&
                                  p.ticketsRemaining > 0 &&
                                  new Date(p.expiryDate) >= today
                              );
              
                              const totalTicketsRemaining = activePacks.reduce((sum, p) => sum + p.ticketsRemaining, 0);
                              const totalInitialTickets = activePacks.reduce((sum, p) => sum + p.initialTickets, 0);

                              return (
                                  <li key={client.id} className={`p-4 sm:p-5 hover:bg-slate-50/50 transition-colors duration-200 ${client.status === ClientStatus.INACTIVE ? 'opacity-60' : ''}`}>
                                      <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between">
                                          <div className="mb-2 sm:mb-0">
                                              <button onClick={() => setSelectedClient(client)} className="text-lg font-semibold text-primary-dark hover:text-accent text-left">
                                                  {client.firstName} {client.lastName}
                                              </button>
                                              <p className="text-sm text-slate-500">{client.email}</p>
                                          </div>
                                          <div className="flex items-center space-x-4">
                                              {totalInitialTickets > 0 && (
                                                  <span className="text-sm text-slate-600 font-medium">
                                                      {totalTicketsRemaining}/{totalInitialTickets} Tickets
                                                  </span>
                                              )}
                                              <span className={`px-2 py-1 text-xs font-semibold rounded-full ${client.status === ClientStatus.ACTIVE ? 'bg-emerald-100 text-emerald-800' : 'bg-rose-100 text-rose-800'}`}>
                                                  {client.status}
                                              </span>
                                              <button onClick={() => { setEditingClient(client); setIsModalOpen(true); }} className="p-2 text-slate-400 hover:text-primary-dark hover:bg-slate-100 rounded-md"><Edit className="h-5 w-5"/></button>
                                          </div>
                                      </div>
                                  </li>
                              );
                          })}
                      </ul>
                  </div>
                  
                  {isModalOpen && <ClientFormModal client={editingClient} onClose={() => setIsModalOpen(false)} onSave={handleSaveClient} onToggleStatus={handleToggleStatus} />}
              </div>
          );
      };

      // --- From screens/TemplatesScreen.js ---
      const TemplateFormModal = ({ template, onSave, onClose }) => {
          const [formData, setFormData] = useState({
              name: template?.name || '',
              ticketCount: template?.ticketCount || 10,
              ticketType: template?.ticketType || TicketType.GROUP,
              price: template?.price || 0,
              expiryMonths: template?.expiryMonths || 1,
          });

          const handleChange = (e) => {
              const { name, value, type } = e.target;
              const isNumber = type === 'number';
              setFormData(prev => ({ ...prev, [name]: isNumber ? Number(value) : value }));
          };

          const handleSubmit = (e) => {
              e.preventDefault();
              onSave({ ...formData, id: template?.id || '', status: template?.status || PackTemplateStatus.ACTIVE });
          };
          
          return (
              <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
                  <div className="bg-white rounded-xl shadow-xl p-8 w-full max-w-md">
                      <h2 className="text-2xl font-bold mb-6 text-primary-dark">{template ? 'Edit Template' : 'Add New Template'}</h2>
                      <form onSubmit={handleSubmit} className="space-y-4">
                          <div>
                              <label className="block text-sm font-medium text-slate-700">Pack Name</label>
                              <input type="text" name="name" value={formData.name} onChange={handleChange} required className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-accent focus:border-accent"/>
                          </div>
                          <div className="grid grid-cols-2 gap-4">
                              <div>
                                  <label className="block text-sm font-medium text-slate-700">Number of Tickets</label>
                                  <input type="number" name="ticketCount" value={formData.ticketCount} onChange={handleChange} required min="1" className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-accent focus:border-accent"/>
                              </div>
                              <div>
                                  <label className="block text-sm font-medium text-slate-700">Ticket Type</label>
                                  <select name="ticketType" value={formData.ticketType} onChange={handleChange} className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-accent focus:border-accent">
                                      <option value={TicketType.GROUP}>Group</option>
                                      <option value={TicketType.PRIVATE}>Private</option>
                                  </select>
                              </div>
                          </div>
                          <div className="grid grid-cols-2 gap-4">
                              <div>
                                  <label className="block text-sm font-medium text-slate-700">Price ($)</label>
                                  <input type="number" name="price" value={formData.price} onChange={handleChange} required min="0" step="0.01" className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-accent focus:border-accent"/>
                              </div>
                              <div>
                                  <label className="block text-sm font-medium text-slate-700">Expiry (Months)</label>
                                  <input type="number" name="expiryMonths" value={formData.expiryMonths} onChange={handleChange} required min="1" className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-accent focus:border-accent"/>
                              </div>
                          </div>
                          <div className="flex justify-end space-x-4 pt-6">
                              <button type="button" onClick={onClose} className="px-4 py-2 bg-slate-200 text-slate-800 rounded-md hover:bg-slate-300 font-semibold">Cancel</button>
                              <button type="submit" className="px-4 py-2 bg-primary-dark text-white rounded-md hover:bg-primary font-semibold">Save Template</button>
                          </div>
                      </form>
                  </div>
              </div>
          );
      };

      const TemplatesScreen = ({ data }) => {
          const { packTemplates, addPackTemplate, updatePackTemplate } = data;
          const [isModalOpen, setIsModalOpen] = useState(false);
          const [editingTemplate, setEditingTemplate] = useState(null);

          const handleSaveTemplate = (templateData) => {
              if (editingTemplate) {
                  updatePackTemplate(templateData);
              } else {
                  addPackTemplate(templateData);
              }
              setIsModalOpen(false);
              setEditingTemplate(null);
          };

          const handleToggleStatus = (template) => {
              const newStatus = template.status === PackTemplateStatus.ACTIVE ? PackTemplateStatus.INACTIVE : PackTemplateStatus.ACTIVE;
              updatePackTemplate({ ...template, status: newStatus });
          };

          return (
              <div className="space-y-6">
                  <div className="flex justify-between items-center">
                      <h2 className="text-3xl font-bold text-primary-dark">Ticket Pack Templates</h2>
                      <button onClick={() => { setEditingTemplate(null); setIsModalOpen(true); }} className="flex items-center px-4 py-2 bg-primary-dark text-white rounded-md shadow-sm hover:bg-primary font-semibold">
                          <PlusCircle className="h-5 w-5 mr-2" />
                          Add Template
                      </button>
                  </div>

                  <div className="bg-white rounded-xl shadow-sm overflow-hidden border border-slate-200/80">
                      <ul className="divide-y divide-slate-200">
                          {packTemplates.sort((a,b) => a.name.localeCompare(b.name)).map(template => (
                              <li key={template.id} className={`p-4 sm:p-5 hover:bg-slate-50/50 transition-colors duration-200 ${template.status === PackTemplateStatus.INACTIVE ? 'opacity-60' : ''}`}>
                                  <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between">
                                      <div className="mb-2 sm:mb-0">
                                          <p className="text-lg font-semibold text-primary-dark">{template.name}</p>
                                          <p className="text-sm text-slate-500">
                                              {template.ticketCount} {template.ticketType} tickets for ${template.price} (Expires in {template.expiryMonths} months)
                                          </p>
                                      </div>
                                      <div className="flex items-center space-x-4">
                                          <span className={`px-2 py-1 text-xs font-semibold rounded-full ${template.status === PackTemplateStatus.ACTIVE ? 'bg-emerald-100 text-emerald-800' : 'bg-rose-100 text-rose-800'}`}>
                                              {template.status}
                                          </span>
                                          <button 
                                              onClick={() => handleToggleStatus(template)} 
                                              className="px-3 py-1.5 text-xs font-semibold text-slate-600 bg-slate-100 hover:bg-slate-200 rounded-full"
                                              title={template.status === PackTemplateStatus.ACTIVE ? 'Set to Inactive' : 'Set to Active'}
                                          >
                                              {template.status === PackTemplateStatus.ACTIVE ? 'Deactivate' : 'Activate'}
                                          </button>
                                          <button onClick={() => { setEditingTemplate(template); setIsModalOpen(true); }} className="p-2 text-slate-400 hover:text-primary-dark hover:bg-slate-100 rounded-md"><Edit className="h-5 w-5"/></button>
                                      </div>
                                  </div>
                              </li>
                          ))}
                      </ul>
                  </div>
                  
                  {isModalOpen && <TemplateFormModal template={editingTemplate} onClose={() => setIsModalOpen(false)} onSave={handleSaveTemplate} />}
              </div>
          );
      };

      // --- From screens/AttendanceScreen.js ---
      const AttendanceScreen = ({ data }) => {
          const { clients, purchasedPacks, packTemplates, attendanceRecords, recordAttendance, deleteAttendance } = data;
          const [classDate, setClassDate] = useState(new Date().toISOString().split('T')[0]);
          const [classType, setClassType] = useState(TicketType.GROUP);
          const [selectedClients, setSelectedClients] = useState(new Set());
          const [searchTerm, setSearchTerm] = useState('');

          const eligibleClients = useMemo(() => {
              const date = new Date(classDate);
              return clients.filter(client => {
                  if (client.status !== ClientStatus.ACTIVE) return false;
                  
                  return purchasedPacks.some(pack => {
                      const template = packTemplates.find(t => t.id === pack.templateId);
                      return pack.clientId === client.id &&
                            template?.ticketType === classType &&
                            pack.ticketsRemaining > 0 &&
                            new Date(pack.expiryDate) >= date;
                  });
              });
          }, [classDate, classType, clients, purchasedPacks, packTemplates]);
          
          const addSelectedClient = (clientId) => {
              setSelectedClients(prev => new Set(prev).add(clientId));
              setSearchTerm('');
          };

          const removeSelectedClient = (clientId) => {
              setSelectedClients(prev => {
                  const newSet = new Set(prev);
                  newSet.delete(clientId);
                  return newSet;
              });
          };
          
          const searchResults = useMemo(() => {
              if (!searchTerm.trim()) return [];
              
              return eligibleClients.filter(client => 
                  !selectedClients.has(client.id) &&
                  `${client.firstName} ${client.lastName}`.toLowerCase().includes(searchTerm.toLowerCase())
              );
          }, [searchTerm, eligibleClients, selectedClients]);

          const selectedClientObjects = useMemo(() => {
              return clients.filter(c => selectedClients.has(c.id))
                  .sort((a,b) => a.lastName.localeCompare(b.lastName));
          }, [selectedClients, clients]);

          const handleSubmit = (e) => {
              e.preventDefault();
              if (selectedClients.size === 0) {
                  alert('Please select at least one client.');
                  return;
              }
              recordAttendance(new Date(classDate), classType, Array.from(selectedClients));
              setSelectedClients(new Set());
          };
          
          const handleDelete = (recordId) => {
              if (window.confirm('Are you sure you want to delete this attendance record? This will restore the ticket to the client.')) {
                  deleteAttendance(recordId);
              }
          };

          const recordsWithClientInfo = useMemo(() => {
              return attendanceRecords
                  .map(record => ({
                      ...record,
                      client: clients.find(c => c.id === record.clientId)
                  }))
                  .sort((a,b) => new Date(b.classDate).getTime() - new Date(a.classDate).getTime());
          }, [attendanceRecords, clients]);

          return (
              <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
                  <div className="lg:col-span-1">
                      <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200/80 sticky top-28">
                          <h2 className="text-2xl font-bold text-primary-dark mb-6">Record Attendance</h2>
                          <form onSubmit={handleSubmit} className="space-y-4">
                              <div>
                                  <label className="block text-sm font-medium text-slate-700">Class Date</label>
                                  <input type="date" value={classDate} onChange={e => setClassDate(e.target.value)} required className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-accent focus:border-accent"/>
                              </div>
                              <div>
                                  <label className="block text-sm font-medium text-slate-700">Class Type</label>
                                  <select value={classType} onChange={e => { setClassType(e.target.value); setSelectedClients(new Set()); }} className="mt-1 block w-full border-slate-300 rounded-md shadow-sm focus:ring-accent focus:border-accent">
                                      <option value={TicketType.GROUP}>Group</option>
                                      <option value={TicketType.PRIVATE}>Private</option>
                                  </select>
                              </div>
                              <div>
                                  <label htmlFor="attendee-search" className="block text-sm font-medium text-slate-700">Attendees</label>
                                  <div className="mt-1 relative">
                                      <div className="w-full p-2 border border-slate-300 rounded-md flex flex-wrap gap-2 min-h-[42px] items-center focus-within:ring-2 focus-within:ring-accent focus-within:border-accent">
                                          {selectedClientObjects.map(client => (
                                              <span key={client.id} className="bg-primary-dark text-white flex items-center gap-2 px-2.5 py-1 text-sm rounded-full">
                                                  {client.firstName} {client.lastName}
                                                  <button type="button" onClick={() => removeSelectedClient(client.id)} className="rounded-full hover:bg-primary transition-colors">
                                                      <X size={14} />
                                                  </button>
                                              </span>
                                          ))}
                                          <input
                                              id="attendee-search"
                                              type="text"
                                              value={searchTerm}
                                              onChange={e => setSearchTerm(e.target.value)}
                                              placeholder={selectedClients.size === 0 ? "Search for attendees..." : ""}
                                              className="flex-grow bg-transparent border-none focus:ring-0 p-0 text-sm"
                                          />
                                      </div>
                                      {searchTerm.trim() && (
                                          <div className="absolute z-10 w-full mt-1 bg-white border border-slate-200 rounded-lg shadow-xl">
                                              <ul className="max-h-60 overflow-y-auto">
                                                  {searchResults.length > 0 ? searchResults.map(client => (
                                                      <li 
                                                          key={client.id} 
                                                          className="p-2 px-3 hover:bg-slate-100 cursor-pointer text-sm"
                                                          onMouseDown={(e) => { 
                                                              e.preventDefault();
                                                              addSelectedClient(client.id);
                                                          }}
                                                      >
                                                          {client.firstName} {client.lastName}
                                                      </li>
                                                  )) : (
                                                      <li className="p-2 px-3 text-sm text-slate-500">No matching eligible clients found.</li>
                                                  )}
                                              </ul>
                                          </div>
                                      )}
                                  </div>
                              </div>
                              <button type="submit" className="w-full mt-6 px-4 py-2 bg-accent text-white rounded-md hover:bg-accent-dark font-semibold">
                                Record Attendance ({selectedClients.size})
                              </button>
                          </form>
                      </div>
                  </div>

                  <div className="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-slate-200/80">
                      <h2 className="text-2xl font-bold text-primary-dark mb-6">Attendance History</h2>
                      <div className="overflow-x-auto">
                          <table className="min-w-full">
                              <thead className="bg-slate-50">
                                  <tr>
                                      <th className="p-4 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider">Date</th>
                                      <th className="p-4 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider">Client</th>
                                      <th className="p-4 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider">Class Type</th>
                                      <th className="p-4 text-right text-xs font-semibold text-slate-500 uppercase tracking-wider">Actions</th>
                                  </tr>
                              </thead>
                              <tbody className="bg-white">
                                  {recordsWithClientInfo.map(record => (
                                      <tr key={record.id} className="border-b border-slate-200">
                                          <td className="p-4 whitespace-nowrap text-sm text-slate-800">{new Date(record.classDate).toLocaleDateString()}</td>
                                          <td className="p-4 whitespace-nowrap text-sm text-slate-800 font-medium">{record.client?.firstName} {record.client?.lastName}</td>
                                          <td className="p-4 whitespace-nowrap text-sm text-slate-500 capitalize">{record.classType}</td>
                                          <td className="p-4 whitespace-nowrap text-right text-sm font-medium">
                                              <button onClick={() => handleDelete(record.id)} className="text-slate-400 hover:text-red-500 p-1">
                                                  <Trash2 className="h-5 w-5"/>
                                              </button>
                                          </td>
                                      </tr>
                                  ))}
                              </tbody>
                          </table>
                      </div>
                      {recordsWithClientInfo.length === 0 && <p className="text-center text-slate-500 py-8">No attendance records found.</p>}
                  </div>
              </div>
          );
      };

      // --- From App.js ---
      const App = () => {
        const data = useAppData();
        const [currentPage, setCurrentPage] = useState(Page.DASHBOARD);

        const renderPage = () => {
          switch (currentPage) {
            case Page.DASHBOARD:
              return <DashboardScreen data={data} />;
            case Page.CLIENTS:
              return <ClientsScreen data={data} />;
            case Page.TEMPLATES:
              return <TemplatesScreen data={data} />;
            case Page.ATTENDANCE:
              return <AttendanceScreen data={data} />;
            default:
              return <DashboardScreen data={data} />;
          }
        };

        const navItems = useMemo(() => [
          { page: Page.DASHBOARD, label: 'Dashboard', icon: LayoutDashboard },
          { page: Page.CLIENTS, label: 'Clients', icon: Users },
          { page: Page.TEMPLATES, label: 'Pack Templates', icon: ClipboardList },
          { page: Page.ATTENDANCE, label: 'Attendance', icon: Calendar },
        ], []);

        return (
          <div className="min-h-screen bg-secondary font-sans text-primary-dark">
            <header className="bg-white/80 backdrop-blur-lg sticky top-0 z-40 border-b border-slate-200">
              <div className="container mx-auto px-4 sm:px-6 lg:px-8">
                <div className="flex flex-col sm:flex-row items-center justify-between h-auto sm:h-20 py-4 sm:py-0">
                  <h1 className="text-2xl sm:text-3xl font-bold tracking-tight text-primary-dark mb-4 sm:mb-0">
                    TicketTrack Pilates
                  </h1>
                  <nav>
                    <ul className="flex flex-wrap justify-center items-center space-x-1 sm:space-x-2">
                      {navItems.map(item => (
                        <li key={item.page}>
                          <button
                            onClick={() => setCurrentPage(item.page)}
                            className={`flex items-center px-4 py-2 rounded-full text-sm font-semibold transition-colors duration-200 ${
                              currentPage === item.page
                                ? 'bg-accent/10 text-accent'
                                : 'text-slate-600 hover:bg-slate-200/60 hover:text-primary-dark'
                            }`}
                            aria-current={currentPage === item.page ? 'page' : undefined}
                          >
                            <item.icon className="mr-2 h-5 w-5" />
                            {item.label}
                          </button>
                        </li>
                      ))}
                    </ul>
                  </nav>
                </div>
              </div>
            </header>
            <main className="container mx-auto p-4 sm:p-6 lg:p-8">
              {renderPage()}
            </main>
          </div>
        );
      };


      // --- Final Render Logic ---
      const rootElement = document.getElementById('root');
      if (!rootElement) {
        throw new Error("Could not find root element to mount to");
      }

      const root = createRoot(rootElement);
      root.render(
        <React.StrictMode>
          <App />
        </React.StrictMode>
      );
    </script>
  </body>
</html>